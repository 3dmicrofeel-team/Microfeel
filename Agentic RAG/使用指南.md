# Agentic RAG 使用指南

## 🚀 快速开始

### 启动系统

**双击运行**：
```
启动.bat
```

脚本会自动：
1. ✅ 检查Python环境
2. ✅ 检查知识库状态
3. ✅ 智能查找可用端口（后端5000-5010，前端8080-8100）
4. ✅ 启动后端和前端服务
5. ✅ 自动打开浏览器

### 访问系统

启动后，浏览器会自动打开前端页面：
- **前端地址**: http://localhost:8080（或脚本显示的端口）
- **后端API**: http://localhost:5000/api/health（或脚本显示的端口）

**注意**: 保持两个服务窗口打开，关闭窗口会停止服务。

---

## 📖 使用步骤

### 1. 配置API Key（可选）

在"模型配置"面板中：
- 输入你的OpenAI API Key（格式：sk-...）
- 点击"保存"按钮保存密钥
- 密钥会安全保存在浏览器本地存储中
- 如果不配置API Key，系统会使用模拟数据（用于测试）

### 2. 选择模型和配置

- **模型**: GPT-4.1 或 GPT-5.1
- **Temperature**: 控制随机性（0-2）
- **Max Tokens**: 最大token数（1000-8000）
- **Top P**: 核采样参数（0-1）
- **Agent模式**: 标准/迭代/多Agent协作

### 2. 输入地图描述

详细描述你想要创建的地图，例如：

```
创建一个新手村地图，包含：
- 中央有一个中世纪风格的村庄
- 村庄有酒馆、商店、铁匠铺
- 村庄北边是一片森林，有1-5级怪物
- 村庄和森林之间有道路连接
```

### 3. 生成LUA脚本

点击"生成LUA脚本"按钮，系统会：
1. 分析你的需求
2. 识别需要的功能模块
3. 检索相关API函数文档（RAG）
4. 生成完整的LUA代码

### 4. 使用生成的代码

- **复制**: 点击复制按钮
- **下载**: 点击下载按钮保存为.lua文件
- **格式化**: 点击格式化按钮美化代码

---

## 🔧 端口配置

### 智能端口查找

启动脚本 `启动.bat` 会自动查找可用端口：
- **后端**: 5000 → 5001 → ... → 5010（自动查找）
- **前端**: 8080 → 8081 → ... → 8100（自动查找）

如果所有端口都被占用，会显示错误信息。

### 端口问题解决

如果遇到端口占用问题：

1. **关闭占用端口的程序**
   ```bash
   # 查找占用端口的进程
   netstat -ano | findstr :8080
   
   # 关闭进程（替换PID为实际进程ID）
   taskkill /PID <PID> /F
   ```

2. **前端端口检测**
   - 前端会自动从URL参数获取后端端口
   - 如果连接失败，检查浏览器控制台（F12）
   - 可以手动设置：`localStorage.setItem('backendPort', '5000')`

---

## 🛠️ 故障排除

### 问题1: Python未找到

**解决**: 确保Python 3.8+已安装并添加到PATH

### 问题2: 知识库未初始化

**解决**:
```bash
cd backend
python init_kb.py
```

### 问题3: 端口全部被占用

**解决**: 关闭占用端口的程序，或修改启动脚本中的端口范围

### 问题4: 前端无法连接后端

**解决**:
1. 检查后端是否正常启动
2. 检查浏览器控制台错误
3. 确认后端端口是否正确

### 问题5: 生成失败

**解决**:
- 如果没有配置API密钥，这是正常的（会使用模拟数据）
- 如需真实生成，在前端界面输入API Key并保存
- 或者编辑 `backend/.env` 添加：`OPENAI_API_KEY=your_key`

---

## 📚 更多文档

- `README.md` - 项目总览和完整说明
- `QUICKSTART.md` - 快速开始指南
- `DEPLOYMENT.md` - 详细部署文档
- `backend/README_RAG.md` - RAG架构详解

---

**最后更新**: 2026-02-08
